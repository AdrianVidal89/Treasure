{% extends "base.html" %}
{% block title %}Gestionar cuentas{% endblock %}
{% block body_class %}dashboard-background{% endblock %}

{% load static %}
{% load humanize %}
{% load custom_filters %}

{% block content %}
<div class="dashboard-container">
    <h2>Gestionar cuentas</h2>
    <h3>Cuentas bancarias</h3>
    <ul>
    {% for cuenta in cuentas_bancarias %}
        <li>
            <a href="{% url 'detalle_cuenta' cuenta.id %}" class="cuenta-link">
                {{ cuenta.nombre }} ‚Äî {{ cuenta.moneda }}
                {% if not cuenta.activa %}(Inactiva){% endif %}
            </a>
            {% if saldos|get_item:cuenta.id %}
                ‚Äî Saldo actual: {{ saldos|get_item:cuenta.id }} ‚Ç¨
            {% else %}
                ‚Äî Sin saldo este mes
            {% endif %}

            <button class="btn-inline-danger" title="Eliminar cuenta"
            onclick="confirmarEliminacion('{% url 'eliminar_cuenta' cuenta.id %}', '{{ cuenta.nombre }}')">
            üóëÔ∏è
            </button>
        
        </li>
    {% empty %}
        <li>No tienes cuentas bancarias registradas.</li>
    {% endfor %}
    </ul>

    <h3>Cuentas de cr√©dito</h3>
    <ul>
        {% for cuenta in cuentas_credito %}
            <li>{{ cuenta.nombre }} {% if cuenta.entidad %}‚Äî {{ cuenta.entidad }}{% endif %}</li>
        {% empty %}
            <li>No tienes cuentas de cr√©dito registradas.</li>
        {% endfor %}
    </ul>

    <h3>Pr√©stamos simples</h3>
    <ul>
        {% for prestamo in prestamos %}
            <li>{{ prestamo.nombre }} ‚Äî {{ prestamo.entidad }}: {{ prestamo.total_pendiente }}‚Ç¨</li>
        {% empty %}
            <li>No tienes pr√©stamos registrados.</li>
        {% endfor %}
    </ul>
</div>

<div style="text-align: center; margin-top: 40px;">
    <button type="button" class="btn btn-danger" onclick="window.location.href='{% url 'dashboard' %}'">Volver al Dashboard Principal</button>
</div>

<!-- Modal de confirmaci√≥n -->
<div id="confirmModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.5); z-index:999;">
    <div class="modal-content" style="background:#1c1c1c; margin: 10% auto; padding: 20px; border: 1px solid #333; width: 300px; color: #eaeaea; text-align:center;">
        <p id="modalText">¬øEst√°s seguro de que quieres eliminar esta cuenta?</p>
        <div style="margin-top: 20px;">
            <button id="confirmDeleteBtn" class="btn btn-danger">Eliminar</button>
            <button onclick="cerrarModal()" class="btn btn-secondary">Cancelar</button>
        </div>
    </div>
</div>

<script>
    let eliminarUrl = null;

    function confirmarEliminacion(url, nombre) {
        eliminarUrl = url;
        document.getElementById('modalText').innerText = `¬øEliminar la cuenta ‚Äú${nombre}‚Äù?`;
        document.getElementById('confirmModal').style.display = 'block';
    }

    function cerrarModal() {
        document.getElementById('confirmModal').style.display = 'none';
        eliminarUrl = null;
    }

    document.addEventListener("DOMContentLoaded", function () {
        const btn = document.getElementById('confirmDeleteBtn');
        btn.addEventListener('click', function () {
            if (eliminarUrl) {
                window.location.href = eliminarUrl;
            }
        });
    });
</script>
{% endblock %}


